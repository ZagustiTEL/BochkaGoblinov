{% extends "base.html" %}
{% block title %}–ü—Ä–æ—Ñ–∏–ª—å{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <h2>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
        <div class="profile-info">
            <p><strong>–õ–æ–≥–∏–Ω:</strong> {{ user.username }}</p>
            <p><strong>–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–∏–∫:</strong> {{ user.unique_nickname }}</p>
        </div>
    </div>
    
    <div class="profile-sections">
        <!-- –°–µ–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥—Ä—É–∑–µ–π -->
        <div class="section search-container">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞</h3>
            <form method="POST" action="{{ url_for('add_friend') }}" class="search-form">
                <input type="text" name="nickname" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ @username" required>
                <button type="submit" class="btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
            </form>
            <p><a href="{{ url_for('search_users') }}">–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</a></p>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞—è–≤–æ–∫ -->
        {% if friend_requests %}
        <div class="section">
            <h3>–ó–∞—è–≤–∫–∏ –≤ –¥—Ä—É–∑—å—è</h3>
            <div class="requests-list">
                {% for request in friend_requests %}
                    <div class="request-item user-item">
                        <div class="request-info user-info">
                            <strong>{{ request.unique_nickname }}</strong> 
                            <span>({{ request.username }})</span>
                            <small>{{ request.requested_at }}</small>
                        </div>
                        <div class="request-actions">
                            <a href="{{ url_for('respond_friend_request', request_id=request.id, action='accept') }}" class="btn">–ü—Ä–∏–Ω—è—Ç—å</a>
                            <a href="{{ url_for('respond_friend_request', request_id=request.id, action='reject') }}" class="btn">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- –°–µ–∫—Ü–∏—è —Å–ø–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π -->
        <div class="section">
            <h3>–ú–æ–∏ –¥—Ä—É–∑—å—è ({{ friends|length }})</h3>
            {% if friends %}
                <div class="friends-list users-list">
                    {% for friend in friends %}
                        <div class="friend-item user-item">
                            <div class="friend-info user-info">
                                <strong>{{ friend.unique_nickname }}</strong>
                                <span>({{ friend.username }})</span>
                                {% if friend.accepted_at %}
                                    <small>–î–æ–±–∞–≤–ª–µ–Ω: {{ friend.accepted_at }}</small>
                                {% endif %}
                                <div>
                                    {% if friend.status == 'online' %}
                                        ‚óè –í —Å–µ—Ç–∏
                                    {% elif friend.status == 'recently' %}
                                        ‚óè –ë—ã–ª(–∞) –Ω–µ–¥–∞–≤–Ω–æ
                                    {% else %}
                                        ‚óã –ù–µ –≤ —Å–µ—Ç–∏
                                    {% endif %}
                                </div>
                            </div>
                            <div class="friend-actions">
                                <a href="{{ url_for('chat_with', receiver_id=friend.id) }}" class="btn">üí¨</a>
                                <a href="{{ url_for('remove_friend', friend_id=friend.id) }}" class="btn" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∏–∑ –¥—Ä—É–∑–µ–π?')">‚úó</a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</p>
            {% endif %}
        </div>
        
    </div>
</div>
{% endblock %}